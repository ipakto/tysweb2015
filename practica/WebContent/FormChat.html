<div id="chat" class="flotante">
  <div id="welcome">
  <label>Welcome,</label>
    <label>Paco</label></div>
  <br>
  <div id="conversacion" style= "overflow-y: scroll;"></div>
  <br>
  <div id="enviar">  
  <input id="txtChat" type="text" size="30" id="texto" placeholder="Escribe aquí tu consulta"
  	onkeypress="submitonenter(conversacion,event,this)"><br>
  <button id="btnEnviar" onclick="enviar()">Enviar</button></div>
</div>
<script>
  var chat=new WebSocket("ws://localhost:8080/practica/ServidorChat");
  chat.onopen=function(){
    var mensaje={
      tipo: "identificacion",
      texto: "pepe@pepe.com"
    };
    chat.send(JSON.stringify(mensaje));
  }
  
  chat.onerror=function(){alert("Error al abrir WS");}
  chat.onclose=function(){alert("WS cerrado");}
  chat.onmessage=function(mensaje){
      var msg = JSON.parse(mensaje.data);
      var txt=msg.contenido;
      var remit=msg.remitente;
      var mensaje=document.createElement("label");
      mensaje.innerHTML = remit+": "+txt;
      var c=document.getElementById("conversacion");
      c.appendChild(mensaje);
     
  }

  function enviar(){
    var textoEnviar=document.getElementById("txtChat");
    var txt = textoEnviar.value;
    if(txt != ""){
      var mensaje=document.createElement("label");
      mensaje.setAttribute("class", "lblDerecha");
      mensaje.innerHTML = "Yo: "+txt;
      var c=document.getElementById("conversacion");
      c.appendChild(mensaje);
      var mensaje={
          tipo: "mensaje",
          texto: txt
        };
      chat.send(JSON.stringify(mensaje));
      textoEnviar.value = "";
      textoEnviar.focus();
    }    
  }
</script>

<script>
    function submitonenter(idChat,evt,thisObj) {
        evt = (evt) ? evt : ((window.event) ? window.event : "")
        if (evt) {
            // process event here
            if ( evt.keyCode==13 || evt.which==13 ) {
                enviar();
            }
        }
    }
</script>
